{% extends 'base.html' %}
{% load static %}

{% block title %}Услуги — AppleYield{% endblock %}

{% block content %}
  <section class="ay-hero">
    <div class="ay-hero-head">
      <div class="ay-hero-spacer"></div>
      <h1 class="ay-hero-title">Услуги для расчета урожайности антоновки</h1>
      {% if current_calculation_id %}
        <a class="ay-cart-link" href="/months_calculation/{{ current_calculation_id }}/" aria-label="Текущая заявка">
          <img class="ay-cart-icon" src="{{ MINIO_STATIC_BASE }}/month_cart.svg" alt="Заявка">
          <span class="ay-badge">{{ calculation_positions_count|default:0 }}</span>
        </a>
      {% else %}
        <span class="ay-cart-link ay-cart-disabled" aria-label="Заявка отсутствует">
          <img class="ay-cart-icon" src="{{ MINIO_STATIC_BASE }}/month_cart.svg" alt="Заявка">
          <span class="ay-badge">0</span>
        </span>
      {% endif %}
    </div>
    <div class="ay-search-center">
      <form method="get" action="/" class="ay-search-form">
        <input class="ay-input-sm" type="text" name="q" placeholder="Поиск по наименованию" value="{{ q }}">
        <button class="ay-btn ay-btn-sm" type="submit">Найти</button>
      </form>
    </div>
  </section>

  <div class="ay-grid-3">
    {% for s in services %}
      <div class="ay-card">
        <div class="ay-card-inner">
          <img src="{{ s.image_url }}" alt="{{ s.name }}">
          <h3>{{ s.name }}</h3>
          <div class="ay-main">{{ s.main_value }}</div>
          <div style="display:flex; gap:10px; align-items:center; justify-content:center;">
            <a href="/month/{{ s.id }}/" class="ay-btn-outline">Подробнее</a>
            <form method="post" action="{% url 'month_add' s.id %}">
              {% csrf_token %}
              <button class="ay-btn-add" type="submit">В расчет</button>
            </form>
          </div>
        </div>
      </div>
    {% empty %}
      <p class="muted">Ничего не найдено.</p>
    {% endfor %}
  </div>
{% endblock %}
